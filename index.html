<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Muslim Luminaries - Quotes</title>
        <link rel="stylesheet" href="css/main.css" />
        <style>
            /* minimal visually-hidden utility for offscreen/live regions */
            .visually-hidden {
                position: absolute !important;
                width: 1px !important;
                height: 1px !important;
                padding: 0 !important;
                margin: -1px !important;
                overflow: hidden !important;
                clip: rect(1px, 1px, 1px, 1px) !important;
                white-space: nowrap !important;
                border: 0 !important;
            }
        </style>
    </head>
    <body>
        <div id="background-container"></div>
        <a class="skip-link" href="#quotes-list">Skip to quotes</a>
        <button
            id="bg-toggle"
            aria-pressed="false"
            aria-label="Switch background"
            title="Switch background"
        >
            ðŸŽ†
        </button>
        <div class="container" role="main">
            <h1 class="visually-hidden">Muslim Luminaries â€” Quotes</h1>
            <div
                id="quotes-list"
                tabindex="-1"
                aria-live="polite"
                aria-atomic="true"
            ></div>
        </div>

        <!-- Live status region for announcing background changes -->
        <div
            id="bg-status"
            class="visually-hidden"
            aria-live="polite"
            aria-atomic="true"
        ></div>

        <!-- Inline script: safer keyboard shortcut for background toggle and announcements.
       Uses capture phase and stopImmediatePropagation to avoid duplicate handlers.
       This augments existing app behavior without modifying external JS files. -->
        <script>
            (function () {
                "use strict";
                // Ensure status region exists (in case some build removed it)
                var status = document.getElementById("bg-status");
                if (!status) {
                    status = document.createElement("div");
                    status.id = "bg-status";
                    status.className = "visually-hidden";
                    status.setAttribute("aria-live", "polite");
                    status.setAttribute("aria-atomic", "true");
                    document.body.appendChild(status);
                }

                // Friendly names for background classes
                var bgNameMap = {
                    "bg-nebula-particles": "Nebula",
                    "bg-wavy-gradient": "Wavy gradient",
                    "bg-cosmic-particles": "Cosmic",
                };

                // Capture-phase keydown handler to safely implement global 'T' toggle.
                // It prevents triggering while typing in inputs and stops other handlers to avoid double-toggle.
                document.addEventListener(
                    "keydown",
                    function (ev) {
                        try {
                            var key =
                                ev.key ||
                                String.fromCharCode(
                                    ev.keyCode || ev.which || 0,
                                );
                            if (!key) return;
                            if (
                                typeof key === "string" &&
                                key.toLowerCase() !== "t"
                            )
                                return;

                            var active = document.activeElement;
                            var tag = active && active.tagName;
                            var isEditable = false;
                            if (active) {
                                isEditable =
                                    active.isContentEditable ||
                                    /INPUT|TEXTAREA|SELECT/.test(tag);
                            }
                            if (isEditable) return;

                            // We will handle this keypress; prevent other handlers from also toggling.
                            ev.stopImmediatePropagation();
                            ev.preventDefault();

                            var btn = document.getElementById("bg-toggle");
                            if (!btn) return;

                            // Activate the toggle via its click handler (preserves existing logic)
                            btn.click();

                            // Announce the new background state
                            var bgContainer = document.getElementById(
                                "background-container",
                            );
                            var name = null;
                            if (bgContainer) {
                                for (
                                    var i = 0;
                                    i < bgContainer.classList.length;
                                    i++
                                ) {
                                    var c = bgContainer.classList[i];
                                    if (bgNameMap[c]) {
                                        name = bgNameMap[c];
                                        break;
                                    }
                                }
                            }
                            if (!name) {
                                // fallback: derive from aria-pressed (best-effort)
                                var pressed = btn.getAttribute("aria-pressed");
                                name =
                                    pressed === "true"
                                        ? "alternate background"
                                        : "default background";
                            }
                            status.textContent =
                                "Background switched to " + name;
                        } catch (e) {
                            // swallow errors, do not break page
                            // (no action here)
                        }
                    },
                    true,
                ); // useCapture = true
            })();
        </script>

        <script src="js/quotes.js"></script>
        <script src="js/app.js"></script>
    </body>
</html>
